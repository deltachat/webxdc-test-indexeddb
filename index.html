<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <script src="webxdc.js"></script>
    </head>
    <body>
        <script>

            var indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB || window.shimIndexedDB;

            var open = indexedDB.open("MyDatabase9", 1);

            open.onupgradeneeded = function() {
                document.writeln("initializing database<br>");
                var db = open.result;
                var store = db.createObjectStore("MyObjectStore", {keyPath: "id"});
                store.createIndex("NameIndex", ["counter"]);
            };

            open.onsuccess = function() {
                var db = open.result;
                var tx = db.transaction("MyObjectStore", "readwrite");
                var store = tx.objectStore("MyObjectStore");

                var getJohn = store.get(12345);

                getJohn.onsuccess = function() {
                    var cnt = 0;
                    if (typeof getJohn.result == "undefined") {
                        cnt = 1;
                    } else {
                        cnt = parseInt(getJohn.result.counter) + 1;
                    }
                    document.writeln("counter: " + cnt + "<br>");
                    store.put({id: 12345, counter: cnt});
                };

                tx.oncomplete = function() {
                    db.close();
                };
            }


        </script>
    </body>
</html>
